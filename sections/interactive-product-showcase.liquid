{{ 'interactive-product-showcase.css' | asset_url | stylesheet_tag }}
<script src="{{ 'interactive-product-showcase.js' | asset_url }}" defer></script>

<section class="interactive-showcase" {% render 'section-properties' %}>
  <div class="container mx-auto px-4">
    
    <!-- Header -->
    <div class="interactive-showcase__header">
      {%- if section.settings.subheading != blank -%}
        <div class="interactive-showcase__subheading">{{ section.settings.subheading }}</div>
      {%- endif -%}
      
      {%- if section.settings.heading != blank -%}
        <h2 class="interactive-showcase__heading">{{ section.settings.heading }}</h2>
      {%- endif -%}
      
      {%- if section.settings.description != blank -%}
        <div class="interactive-showcase__description">{{ section.settings.description }}</div>
      {%- endif -%}
    </div>
    
    <!-- Filters -->
    <div class="interactive-showcase__filters">
      <div class="interactive-showcase__filter-tabs">
        {%- for block in section.blocks -%}
          <button class="interactive-showcase__filter-tab {% if forloop.first %}active{% endif %}" 
                  data-collection="{{ block.settings.collection }}"
                  {{ block.shopify_attributes }}>
            {{ block.settings.tab_heading | default: collections[block.settings.collection].title }}
          </button>
        {%- endfor -%}
      </div>
      
      <div class="interactive-showcase__view-options">
        <button class="interactive-showcase__view-btn active" data-view="grid">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <rect x="3" y="3" width="5" height="5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="12" y="3" width="5" height="5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="3" y="12" width="5" height="5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="12" y="12" width="5" height="5" stroke="currentColor" stroke-width="1.5"/>
          </svg>
        </button>
        <button class="interactive-showcase__view-btn" data-view="list">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M3 6H17M3 10H17M3 14H17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Products Grid -->
    <div class="interactive-showcase__products" id="products-container">
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = collections[block.settings.collection]
          assign products_to_show = section.settings.products_to_show | default: 8
        -%}
        
        <div class="interactive-showcase__collection {% if forloop.first %}active{% endif %}" 
             data-collection="{{ block.settings.collection }}">
          
          <div class="interactive-showcase__grid">
            {%- for product in collection.products limit: products_to_show -%}
              <div class="interactive-showcase__product-card" data-product-id="{{ product.id }}">
                
                <!-- Product Image -->
                <div class="interactive-showcase__product-image">
                  <a href="{{ product.url }}">
                    {%- if product.featured_media -%}
                      <img src="{{ product.featured_media | image_url: width: 400 }}" 
                           alt="{{ product.title }}"
                           loading="lazy"
                           class="interactive-showcase__image-primary">
                      
                      {%- if product.media[1] -%}
                        <img src="{{ product.media[1] | image_url: width: 400 }}" 
                             alt="{{ product.title }}"
                             loading="lazy"
                             class="interactive-showcase__image-hover">
                      {%- endif -%}
                    {%- else -%}
                      <div class="interactive-showcase__image-placeholder">
                        <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                          <rect width="60" height="60" fill="#f3f4f6"/>
                          <path d="M20 20H40V40H20V20Z" stroke="#d1d5db" stroke-width="2"/>
                        </svg>
                      </div>
                    {%- endif -%}
                  </a>
                  
                  <!-- Quick Actions -->
                  <div class="interactive-showcase__quick-actions">
                    <button class="interactive-showcase__quick-btn" 
                            data-action="quick-view" 
                            data-product-id="{{ product.id }}"
                            title="Quick View">
                      <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M1 9C1 9 4 3 9 3C14 3 17 9 17 9C17 9 14 15 9 15C4 15 1 9 1 9Z" stroke="currentColor" stroke-width="1.5"/>
                        <circle cx="9" cy="9" r="3" stroke="currentColor" stroke-width="1.5"/>
                      </svg>
                    </button>
                    
                    <button class="interactive-showcase__quick-btn" 
                            data-action="add-to-wishlist" 
                            data-product-id="{{ product.id }}"
                            title="Add to Wishlist">
                      <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M15.663 3.126C15.24 2.702 14.738 2.365 14.184 2.134C13.631 1.903 13.037 1.782 12.438 1.782C11.838 1.782 11.244 1.903 10.691 2.134C10.137 2.365 9.635 2.702 9.212 3.126L8.5 3.838L7.788 3.126C6.932 2.27 5.785 1.782 4.588 1.782C3.39 1.782 2.243 2.27 1.388 3.126C0.532 3.981 0.044 5.128 0.044 6.326C0.044 7.523 0.532 8.67 1.388 9.526L2.1 10.238L8.5 16.638L14.9 10.238L15.612 9.526C16.036 9.103 16.373 8.601 16.604 8.047C16.835 7.494 16.956 6.9 16.956 6.301C16.956 5.701 16.835 5.107 16.604 4.554C16.373 4 16.036 3.498 15.612 3.075L15.663 3.126Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    
                    <button class="interactive-showcase__quick-btn" 
                            data-action="compare" 
                            data-product-id="{{ product.id }}"
                            title="Compare">
                      <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M3 3V15H15M7 11L9 9L13 13L17 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                  
                  <!-- Sale Badge -->
                  {%- if product.compare_at_price > product.price -%}
                    <div class="interactive-showcase__badge interactive-showcase__badge--sale">
                      {%- assign savings = product.compare_at_price | minus: product.price -%}
                      {%- assign savings_percent = savings | times: 100 | divided_by: product.compare_at_price -%}
                      -{{ savings_percent }}%
                    </div>
                  {%- endif -%}
                  
                  {%- if product.tags contains 'new' -%}
                    <div class="interactive-showcase__badge interactive-showcase__badge--new">New</div>
                  {%- endif -%}
                </div>
                
                <!-- Product Info -->
                <div class="interactive-showcase__product-info">
                  <div class="interactive-showcase__product-category">
                    {{ product.type }}
                  </div>
                  
                  <h3 class="interactive-showcase__product-title">
                    <a href="{{ product.url }}">{{ product.title }}</a>
                  </h3>
                  
                  {%- if section.settings.show_rating -%}
                    <div class="interactive-showcase__rating">
                      {%- for i in (1..5) -%}
                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" class="interactive-showcase__star">
                          <path d="M7 1L8.854 4.764L13 5.382L10 8.236L10.708 12.382L7 10.382L3.292 12.382L4 8.236L1 5.382L5.146 4.764L7 1Z" fill="#fbbf24"/>
                        </svg>
                      {%- endfor -%}
                      <span class="interactive-showcase__rating-count">({{ product.metafields.reviews.rating_count | default: '24' }})</span>
                    </div>
                  {%- endif -%}
                  
                  <div class="interactive-showcase__price">
                    {%- if product.compare_at_price > product.price -%}
                      <span class="interactive-showcase__price-compare">{{ product.compare_at_price | money }}</span>
                    {%- endif -%}
                    <span class="interactive-showcase__price-current">{{ product.price | money }}</span>
                  </div>
                  
                  <!-- Color Swatches -->
                  {%- if product.options contains 'Color' -%}
                    <div class="interactive-showcase__color-swatches">
                      {%- for variant in product.variants limit: 5 -%}
                        {%- if variant.option1 != blank -%}
                          <div class="interactive-showcase__color-swatch" 
                               style="background-color: {{ variant.option1 | downcase | replace: ' ', '' }};"
                               title="{{ variant.option1 }}"></div>
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                  {%- endif -%}
                  
                  <!-- Add to Cart -->
                  <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="interactive-showcase__cart-form">
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                    <button type="submit" 
                            class="interactive-showcase__add-to-cart"
                            {% unless product.available %}disabled{% endunless %}>
                      {%- if product.available -%}
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path d="M2 2H3.333L5.067 9.733C5.133 10.067 5.333 10.367 5.633 10.567C5.933 10.767 6.3 10.867 6.667 10.867H12.667C13.033 10.867 13.4 10.767 13.7 10.567C14 10.367 14.2 10.067 14.267 9.733L15.333 4.667H4M6.667 14C6.667 14.733 6.067 15.333 5.333 15.333C4.6 15.333 4 14.733 4 14C4 13.267 4.6 12.667 5.333 12.667C6.067 12.667 6.667 13.267 6.667 14ZM14.667 14C14.667 14.733 14.067 15.333 13.333 15.333C12.6 15.333 12 14.733 12 14C12 13.267 12.6 12.667 13.333 12.667C14.067 12.667 14.667 13.267 14.667 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Add to Cart
                      {%- else -%}
                        Sold Out
                      {%- endif -%}
                    </button>
                  </form>
                </div>
              </div>
            {%- endfor -%}
          </div>
          
          {%- if collection.products.size > products_to_show -%}
            <div class="interactive-showcase__load-more">
              <button class="interactive-showcase__load-more-btn" data-collection="{{ block.settings.collection }}">
                Load More Products
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
  
  <!-- Quick View Modal -->
  <div class="interactive-showcase__modal" id="quick-view-modal">
    <div class="interactive-showcase__modal-overlay"></div>
    <div class="interactive-showcase__modal-content">
      <button class="interactive-showcase__modal-close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="interactive-showcase__modal-body">
        <!-- Quick view content will be loaded here -->
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const showcase = document.querySelector('.interactive-showcase');
  if (showcase && typeof InteractiveProductShowcase !== 'undefined') {
    new InteractiveProductShowcase(showcase);
  }
});
</script>

{% schema %}
{
  "name": "Interactive Product Showcase",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Featured Collections"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Discover Our Best Furniture"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Explore our curated selection of premium furniture pieces, carefully chosen for quality, style, and comfort.</p>"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 16,
      "step": 2,
      "label": "Products to show initially",
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product ratings",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "tab_heading",
          "label": "Tab heading",
          "info": "Leave blank to use collection name"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Interactive Product Showcase",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}
